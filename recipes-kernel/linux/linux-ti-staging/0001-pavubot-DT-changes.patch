From 8960d930594f18302ad5330150a88c36c0a46fec Mon Sep 17 00:00:00 2001
From: Maciej Sobkowski <maciejjo@maciejjo.pl>
Date: Wed, 15 Jun 2016 17:36:04 +0200
Subject: [PATCH] pavubot DT changes

---
 arch/arm/boot/dts/am335x-boneblack.dts | 141 +++++++++++++++++++++++++++------
 arch/arm/boot/dts/am33xx.dtsi          |  75 ++++--------------
 2 files changed, 132 insertions(+), 84 deletions(-)

diff --git a/arch/arm/boot/dts/am335x-boneblack.dts b/arch/arm/boot/dts/am335x-boneblack.dts
index 3d993ae..a2a1f12 100644
--- a/arch/arm/boot/dts/am335x-boneblack.dts
+++ b/arch/arm/boot/dts/am335x-boneblack.dts
@@ -34,6 +34,123 @@
 	status = "okay";
 };
 
+&am33xx_pinmux {
+
+	/* Pins configuration for various appliances */
+	servo_pwm_P9_16: pinmux_pwm_P9_16_pins {
+		pinctrl-single,pins = <0x04c  0x6>; /* P9_16 (ZCZ ball T14) | MODE 6 */
+	};
+
+	dc_motor_driver_pins: pinmux_dc_motor_driver {
+		pinctrl-single,pins = <
+			0x020  0x04
+			0x024  0x04
+			0x090  0x2F
+			0x09c  0x2F
+			0x034  0x2F
+			0x03c  0x2F
+			0x02c  0x2F
+		>;
+	};
+
+	dagu_encoder_l_pins: pinmux_dagu_encoder_left {
+		pinctrl-single,pins = <0x0B8 0x2F>;
+	};
+
+	dagu_encoder_r_pins: pinmux_dagu_encoder_right {
+		pinctrl-single,pins = <0x0B0 0x2F>;
+	};
+
+	mpu_6500_pins: pinmux_mpu_6500 {
+		pinctrl-single,pins = <0x184 0x2F>;
+	};
+
+	pru_hcsr04_pins: pinmux_pru_hcsr04 {
+		pinctrl-single,pins = <
+			0x1A4 0x05
+			0x19C 0x26
+		>;
+	};
+
+};
+
+/ {
+	ocp {
+		servo: servo {
+			compatible= "pwm_servo";
+
+			pwms = <&ehrpwm1 1 20000000 1>;
+			pwm-names = "angle";
+
+			pinctrl-names = "default";
+			pinctrl-0 = <&servo_pwm_P9_16>;
+
+			enabled = <0>;
+			duty = <0>;
+			status = "okay";
+		};
+
+		dc_motor_driver: tb6612fng {
+			compatible = "toshiba,tb6612fng";
+
+			pinctrl-names = "default";
+			pinctrl-0 = <&dc_motor_driver_pins>;
+
+			pwms =
+				<&ehrpwm2 1 10000000 1>,
+				<&ehrpwm2 0 10000000 1>;
+
+			pwm-names = "motor_a", "motor_b";
+
+			ain1-gpio = <&gpio2 5 0>;
+			ain2-gpio = <&gpio2 2 0>;
+			bin1-gpio = <&gpio1 15 0>;
+			bin2-gpio = <&gpio0 27 0>;
+			stby-gpio = <&gpio1 13 0>;
+		};
+
+		rotary_encoder_left: dagu_encoder@212 {
+			compatible = "dagu,hall-encoder";
+
+			pinctrl-names = "default";
+			pinctrl-0 = <&dagu_encoder_l_pins>;
+
+			interrupt-parent = <&gpio2>;
+			interrupts = <12 1>;
+		};
+
+		rotary_encoder_right: dagu_encoder@210 {
+			compatible = "dagu,hall-encoder";
+
+			pinctrl-names = "default";
+			pinctrl-0 = <&dagu_encoder_r_pins>;
+
+			interrupt-parent = <&gpio2>;
+			interrupts = <10 1>;
+		};
+
+	};
+};
+
+&pruss {
+	status = "okay";
+	pinctrl-names = "default";
+	pinctrl-0 = <&pru_hcsr04_pins>;
+};
+
+
+&i2c2 {
+	mpu6500@68 {
+		compatible = "invensense,mpu6500";
+		reg = <0x68>;
+		pinctrl-names = "default";
+		pinctrl-0 = <&mpu_6500_pins>;
+		interrupt-parent = <&gpio0>;
+		interrupts = <15 1>;
+	};
+
+};
+
 &cpu0_opp_table {
 	/*
 	 * All PG 2.0 silicon may not support 1GHz but some of the early
@@ -76,16 +193,6 @@
 			0x1b0 0x03      /* xdma_event_intr0, OMAP_MUX_MODE3 | AM33XX_PIN_OUTPUT */
 		>;
 	};
-
-	mcasp0_pins: mcasp0_pins {
-		pinctrl-single,pins = <
-			AM33XX_IOPAD(0x9ac, PIN_INPUT_PULLUP | MUX_MODE0) /* mcasp0_ahcklx.mcasp0_ahclkx */
-			AM33XX_IOPAD(0x99c, PIN_OUTPUT_PULLDOWN | MUX_MODE2) /* mcasp0_ahclkr.mcasp0_axr2*/
-			AM33XX_IOPAD(0x994, PIN_OUTPUT_PULLUP | MUX_MODE0) /* mcasp0_fsx.mcasp0_fsx */
-			AM33XX_IOPAD(0x990, PIN_OUTPUT_PULLDOWN | MUX_MODE0) /* mcasp0_aclkx.mcasp0_aclkx */
-			AM33XX_IOPAD(0x86c, PIN_OUTPUT_PULLDOWN | MUX_MODE7) /* gpmc_a11.GPIO1_27 */
-		>;
-	};
 };
 
 &lcdc {
@@ -123,20 +230,6 @@
 	system-power-controller;
 };
 
-&mcasp0	{
-	#sound-dai-cells = <0>;
-	pinctrl-names = "default";
-	pinctrl-0 = <&mcasp0_pins>;
-	status = "okay";
-	op-mode = <0>;	/* MCASP_IIS_MODE */
-	tdm-slots = <2>;
-	serial-dir = <	/* 0: INACTIVE, 1: TX, 2: RX */
-			0 0 1 0
-		>;
-	tx-num-evt = <32>;
-	rx-num-evt = <32>;
-};
-
 &sgx {
 	status = "okay";
 };
diff --git a/arch/arm/boot/dts/am33xx.dtsi b/arch/arm/boot/dts/am33xx.dtsi
index 32e7bbb..0b66dc6 100644
--- a/arch/arm/boot/dts/am33xx.dtsi
+++ b/arch/arm/boot/dts/am33xx.dtsi
@@ -588,6 +588,17 @@
 			ti,timer-pwm;
 		};
 
+		pruss: pruss@4a300000 {
+			compatible = "ti,pruss-v2";
+			ti,hwmods = "pruss";
+			ti,deassert-hard-reset = "pruss", "pruss";
+			reg = <0x4a300000 0x080000>;
+			ti,pintc-offset = <0x20000>;
+			interrupt-parent = <&intc>;
+			status = "okay";
+			interrupts = <20 21 22 23 24 25 26 27>;
+		};
+
 		rtc: rtc@44e3e000 {
 			compatible = "ti,am3352-rtc", "ti,da830-rtc";
 			reg = <0x44e3e000 0x1000>;
@@ -792,7 +803,7 @@
 			ti,hwmods = "epwmss1";
 			#address-cells = <1>;
 			#size-cells = <1>;
-			status = "disabled";
+			status = "okay";
 			ranges = <0x48302100 0x48302100 0x80   /* ECAP */
 				  0x48302180 0x48302180 0x80   /* EQEP */
 				  0x48302200 0x48302200 0x80>; /* EHRPWM */
@@ -812,7 +823,7 @@
 				reg = <0x48302200 0x80>;
 				clocks = <&ehrpwm1_tbclk>;
 				clock-names = "tbclk";
-				status = "disabled";
+				status = "okay";
 			};
 		};
 
@@ -822,7 +833,7 @@
 			ti,hwmods = "epwmss2";
 			#address-cells = <1>;
 			#size-cells = <1>;
-			status = "disabled";
+			status = "okay";
 			ranges = <0x48304100 0x48304100 0x80   /* ECAP */
 				  0x48304180 0x48304180 0x80   /* EQEP */
 				  0x48304200 0x48304200 0x80>; /* EHRPWM */
@@ -842,7 +853,7 @@
 				reg = <0x48304200 0x80>;
 				clocks = <&ehrpwm2_tbclk>;
 				clock-names = "tbclk";
-				status = "disabled";
+				status = "okay";
 			};
 		};
 
@@ -915,62 +926,6 @@
 			reg = <0x40302000 0xe000>; /* 64k - 8k */
 		};
 
-		pruss: pruss@4a300000 {
-			compatible = "ti,am3352-pruss";
-			ti,hwmods = "pruss";
-			reg = <0x4a300000 0x2000>,
-			      <0x4a302000 0x2000>,
-			      <0x4a310000 0x3000>,
-			      <0x4a320000 0x2000>,
-			      <0x4a326000 0x2000>,
-			      <0x4a32e000 0x31c>,
-			      <0x4a332000 0x58>;
-			reg-names = "dram0", "dram1", "shrdram2", "intc", "cfg",
-				    "iep", "mii_rt";
-			#address-cells = <1>;
-			#size-cells = <1>;
-			ranges;
-
-			pruss_intc: intc@4a320000 {
-				compatible = "ti,am3352-pruss-intc";
-				interrupts = <20 21 22 23 24 25 26 27>;
-				interrupt-names = "host2", "host3", "host4",
-						  "host5", "host6", "host7",
-						  "host8", "host9";
-				interrupt-controller;
-				#interrupt-cells = <1>;
-			};
-
-			pru0: pru0@4a334000 {
-				compatible = "ti,am3352-pru";
-				reg = <0x4a334000 0x2000>,
-				      <0x4a322000 0x400>,
-				      <0x4a322400 0x100>;
-				reg-names = "iram", "control", "debug";
-				mboxes = <&mailbox &mbox_pru0>;
-			};
-
-			pru1: pru1@4a338000 {
-				compatible = "ti,am3352-pru";
-				reg = <0x4a338000 0x2000>,
-				      <0x4a324000 0x400>,
-				      <0x4a324400 0x100>;
-				reg-names = "iram", "control", "debug";
-				mboxes = <&mailbox &mbox_pru1>;
-			};
-
-			pruss_mdio: mdio@4a332400 {
-				compatible = "ti,davinci_mdio";
-				reg = <0x4a332400 0x90>;
-				clocks = <&dpll_core_m4_ck>;
-				clock-names = "fck";
-				bus_freq = <1000000>;
-				#address-cells = <1>;
-				#size-cells = <0>;
-				status = "disabled";
-			};
-		};
-
 		elm: elm@48080000 {
 			compatible = "ti,am3352-elm";
 			reg = <0x48080000 0x2000>;
-- 
2.8.3

